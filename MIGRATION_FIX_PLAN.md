# –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ stage

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –ø—É—à–∞ –Ω–∞ stage –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞:
```
ProgrammingError: column services_app_service.image does not exist
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∏–≥—Ä–∞—Ü–∏—è `0017_service_image.py` –Ω–µ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ stage, —Ö–æ—Ç—è –∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–µ `image`.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ stage

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ stage –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**

```bash
cd /path/to/app/mysite
source venv/bin/activate
export DJANGO_SETTINGS_MODULE=mysite.settings.staging

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
python manage.py showmigrations services_app

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
# services_app
#  [X] 0001_initial
#  [X] 0002_...
#  ...
#  [ ] 0017_service_image  ‚Üê –ï—Å–ª–∏ –∑–¥–µ—Å—å [ ], –∑–Ω–∞—á–∏—Ç –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –¥–µ–ø–ª–æ—è

–í GitHub Actions –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π:
- –û—Ç–∫—Ä—ã—Ç—å Actions ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π workflow run
- –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é "üîÑ Running migrations..."
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –±—ã–ª–∞ –ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `0017_service_image`

## üîß –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –Ω–∞ stage (–ë–´–°–¢–†–û–ï)

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ stage:**

```bash
cd /path/to/app/mysite
source venv/bin/activate
export DJANGO_SETTINGS_MODULE=mysite.settings.staging

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la mysite/services_app/migrations/0017_service_image.py

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python manage.py migrate services_app 0017_service_image --verbosity 2

# –ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate --noinput --verbosity 2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
python manage.py showmigrations services_app | grep 0017
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: [X] 0017_service_image

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl restart formula_tela
# –∏–ª–∏
sudo systemctl restart <service_name>
```

### –†–µ—à–µ–Ω–∏–µ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π –∑–∞–Ω–æ–≤–æ (–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï)

**–í GitHub:**

1. –û—Ç–∫—Ä—ã—Ç—å Actions
2. –ù–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π workflow –¥–ª—è staging
3. –ù–∞–∂–∞—Ç—å "Re-run jobs" ‚Üí "Re-run failed jobs" (–∏–ª–∏ "Re-run all jobs")

–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
1. Actions ‚Üí "Deploy to Staging (SSH)"
2. –ù–∞–∂–∞—Ç—å "Run workflow" ‚Üí –≤—ã–±—Ä–∞—Ç—å –≤–µ—Ç–∫—É `dev` ‚Üí "Run workflow"

**–£–ª—É—á—à–µ–Ω–Ω—ã–π workflow —Ç–µ–ø–µ—Ä—å:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º (`--verbosity 2`)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**–õ–æ–∫–∞–ª—å–Ω–æ:**

```bash
git log --oneline --all -- mysite/services_app/migrations/0017_service_image.py
git show dev:mysite/services_app/migrations/0017_service_image.py
```

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ stage:**

```bash
cd /path/to/repo
git fetch origin dev
git show origin/dev:mysite/services_app/migrations/0017_service_image.py
```

–ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–Ω–∞—á–∏—Ç –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –±—ã–ª–∞ –∑–∞–ø—É—à–µ–Ω–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ

1. –û—Ç–∫—Ä—ã—Ç—å `https://stg.formulatela58.ru/admin/services_app/service/`
2. –û—Ç–∫—Ä—ã—Ç—å –ª—é–±—É—é —É—Å–ª—É–≥—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ª—É–≥–∏" –±–µ–∑ –æ—à–∏–±–æ–∫

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
psql -U mysite_stage_user -d mysite_stage -h localhost

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
\d services_app_service

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∞:
# image | character varying(100) | | |
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
# –õ–æ–≥–∏ gunicorn
sudo journalctl -u formula_tela -n 50 --no-pager

# –ò–ª–∏ –ª–æ–≥–∏ nginx
sudo tail -f /var/log/nginx/error.log
```

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

1. **–°–†–û–ß–ù–û:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –Ω–∞ stage (–†–µ—à–µ–Ω–∏–µ 1)
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –ß—Ç–æ –∞–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:** –£–ª—É—á—à–∏—Ç—å workflow –¥–ª—è –ª—É—á—à–µ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)

## üìã –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ stage (`showmigrations`)
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ –¥–µ–ø–ª–æ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ `image` –ø–æ—è–≤–∏–ª–∞—Å—å –≤ –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–º–∏–Ω–∫—É - –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —É—Å–ª—É–≥–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ workflow —É–ª—É—á—à–µ–Ω –¥–ª—è –±—É–¥—É—â–∏—Ö –¥–µ–ø–ª–æ–µ–≤

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-18  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

