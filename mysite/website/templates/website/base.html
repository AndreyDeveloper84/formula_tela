<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}–≠—Å—Ç–µ—Ç–∏–∫–∞ —Ç–µ–ª–∞{% endblock %}</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:#222}
    header,footer{padding:14px 20px;background:#0f172a;color:#fff}
    header a,nav a{color:#fff;text-decoration:none;margin-right:14px}
    .container{max-width:1040px;margin:0 auto;padding:20px}
    .grid{display:grid;gap:16px}
    .grid-3{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:14px;background:#fff}
    .btn{display:inline-block;background:#2563eb;color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none}
    .muted{color:#6b7280;font-size:14px}
  </style>
</head>
<body>
<header>
  <nav class="container">
    <a href="{% url 'website:home' %}"><b>{{ settings.salon_name|default:'–°–∞–ª–æ–Ω' }}</b></a>
    <a href="{% url 'website:services' %}">–£—Å–ª—É–≥–∏</a>
    <a href="{% url 'website:masters' %}">–ú–∞—Å—Ç–µ—Ä–∞</a>
    <a href="{% url 'website:promotions' %}">–ê–∫—Ü–∏–∏</a>
    <a href="{% url 'website:bundles' %}">–ö–æ–º–ø–ª–µ–∫—Å—ã</a>
    <a href="{% url 'website:contacts' %}">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    <a class="btn" style="float:right" id="book-btn" data-booking href="#">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
  </nav>
</header>

<main class="container">
  {% block content %}{% endblock %}
</main>

<footer>
  <div class="container">
    {{ settings.address }} ¬∑ {{ settings.phone }}
  </div>
</footer>

{# –ó–∞–≥–ª—É—à–∫–∞ –ø–æ–¥ –≤–∏–¥–∂–µ—Ç YCLIENTS. –ü–æ–∑–∂–µ –ø–æ–¥—Å—Ç–∞–≤–∏–º —Ä–µ–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∏ companyId #}
{% if settings.yclients_company_id %}
<script>
(function () {
  var COMPANY_ID = "{{ settings.yclients_company_id|escapejs }}";
  var WIDGET_DOMAIN = "n951024"; // –ü–æ–¥–¥–æ–º–µ–Ω –≤–∏–¥–∂–µ—Ç–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ YClients
  
  console.log("üîß –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ YClients");
  console.log("   Company ID:", COMPANY_ID);
  console.log("   Widget Domain:", WIDGET_DOMAIN);

  var widgetReady = false;
  var pendingClicks = [];

  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç –≤–∏–¥–∂–µ—Ç–∞
  var s = document.createElement("script");
  s.async = true;
  s.src = "https://" + WIDGET_DOMAIN + ".yclients.com/widgetJS";
  
  console.log("üì° URL –≤–∏–¥–∂–µ—Ç–∞:", s.src);
  
  s.onload = function () {
    console.log("‚úÖ –°–∫—Ä–∏–ø—Ç –≤–∏–¥–∂–µ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω");
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
    setTimeout(function() {
      if (window.YC && YC.init && YC.open) {
        console.log("‚úÖ YClients API –¥–æ—Å—Ç—É–ø–µ–Ω");
        widgetReady = true;
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–ª–∏–∫–∏
        if (pendingClicks.length > 0) {
          console.log("üìã –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–ª–∏–∫–æ–≤:", pendingClicks.length);
          pendingClicks.forEach(function(data) {
            openWidget(data.serviceId, data.staffId);
          });
          pendingClicks = [];
        }
      } else {
        console.warn("‚ö†Ô∏è window.YC –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞");
      }
    }, 300);
  };
  
  s.onerror = function(e) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ YClients");
    console.error("   URL:", s.src);
    console.error("   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å YClients –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–¥–æ–º–µ–Ω–∞");
  };
  
  document.head.appendChild(s);

  // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∏–¥–∂–µ—Ç–∞
  function openWidget(serviceId, staffId) {
    if (!widgetReady) {
      console.warn("‚ö†Ô∏è –í–∏–¥–∂–µ—Ç –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤");
      return false;
    }
    
    console.log("=== –û–¢–ö–†–´–¢–ò–ï –í–ò–î–ñ–ï–¢–ê ===");
    console.log("   Service ID:", serviceId);
    console.log("   Staff ID:", staffId);
    console.log("   Company ID:", COMPANY_ID);
    
    try {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      YC.init({ companyId: COMPANY_ID });
      console.log("   ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
      
      // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
      var opts = {};
      if (serviceId) {
        opts.service_id = parseInt(serviceId, 10);
        console.log("   üìã Service ID:", opts.service_id);
      }
      if (staffId) {
        opts.staff_id = parseInt(staffId, 10);
        console.log("   üë§ Staff ID:", opts.staff_id);
      }
      
      console.log("üì§ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–¥–∂–µ—Ç–∞:", opts);
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º
      YC.open(opts);
      
      console.log("‚úÖ –í–∏–¥–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç!");
      console.log("=======================");
      
      return true;
    } catch (error) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∏–¥–∂–µ—Ç–∞:", error);
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∏–¥–∂–µ—Ç–∞ –∑–∞–ø–∏—Å–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º.");
      return false;
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
  document.addEventListener("click", function (e) {
    var btn = e.target.closest("[data-booking]");
    if (!btn) return;
    
    e.preventDefault();
    console.log("üñ±Ô∏è –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏");
    
    var serviceId = btn.getAttribute("data-service-id");
    var staffId = btn.getAttribute("data-staff-id");
    
    console.log("   data-service-id:", serviceId);
    console.log("   data-staff-id:", staffId);
    
    // –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –≥–æ—Ç–æ–≤
    if (!widgetReady) {
      console.warn("‚è≥ –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...");
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
      pendingClicks.push({ serviceId: serviceId, staffId: staffId });
      
      alert("–í–∏–¥–∂–µ—Ç –∑–∞–ø–∏—Å–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ –∏ –Ω–∞–∂–º–∏—Ç–µ —Å–Ω–æ–≤–∞.");
      return;
    }
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç
    openWidget(serviceId, staffId);
  });
  
  console.log("‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã");
})();
</script>
{% else %}
<script>
  console.warn("‚ö†Ô∏è YClients Company ID –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∞–π—Ç–∞");
  document.addEventListener("click", function (e) {
    var t = e.target.closest("[data-booking]");
    if (t) {
      e.preventDefault();
      alert("–ó–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: –Ω–µ —É–∫–∞–∑–∞–Ω YCLIENTS company id –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∞–π—Ç–∞.");
    }
  });
</script>
{% endif %}
</body>
</html>
