{% extends "website/base.html" %}
{% load service_extras humanize %}
{% block title %}–£—Å–ª—É–≥–∏ ‚Äî {{ settings.salon_name }}{% endblock %}
{% block content %}
  <h1 class="text-3xl font-bold mb-6">–£—Å–ª—É–≥–∏</h1>

{% for cat in categories %}
  <h2 class="mb-4">{{ cat.name }}</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {% for s in cat.services.all %}
    {% if s.is_active %}
    <div class="p-5 rounded-2xl shadow bg-white">
      <h3 class="text-lg font-semibold mb-2">{{ s.name }}</h3>
      
      {% if s.options.all %}
        <div>
          <label class="block text-sm mb-1">–í–∞—Ä–∏–∞–Ω—Ç</label>
          <select name="service_option_id" id="opt-{{ s.id }}" class="w-full border rounded px-3 py-2 mb-3" onchange="updateBookingButton('{{ s.id }}')">
            {% for opt in s.options.all %}
              {% if opt.is_active %}
                <option
                  value="{{ opt.id }}"
                  data-duration="{{ opt.duration_min }}"
                  data-price="{{ opt.price }}"
                  data-yclients-id="{{ opt.yclients_service_id }}"
                >
                  {{ opt|option_label }}
                </option>
              {% endif %}
            {% endfor %}
          </select>

          {# –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–∏—Å–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º service-id #}
          <a class="btn" 
             id="btn-{{ s.id }}"
             data-booking 
             data-service-id=""
             href="#">
            –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
          </a>
        </div>
      {% else %}
        <p class="text-sm text-gray-500">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</p>
      {% endif %}
    </div>
    {% endif %}
  {% endfor %}
  </div>
{% endfor %}

<script>
// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è service_id –Ω–∞ –∫–Ω–æ–ø–∫–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞
function updateBookingButton(serviceId) {
  const select = document.getElementById('opt-' + serviceId);
  const button = document.getElementById('btn-' + serviceId);
  
  if (!select || !button) return;
  
  const selectedOption = select.options[select.selectedIndex];
  const yclientsId = selectedOption.getAttribute('data-yclients-id');
  
  console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É—Å–ª—É–≥–∏', serviceId);
  console.log('   YClients ID:', yclientsId || '–Ω–µ —É–∫–∞–∑–∞–Ω');
  
  if (yclientsId) {
    button.setAttribute('data-service-id', yclientsId);
  } else {
    button.removeAttribute('data-service-id');
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º service_id –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
  console.log('üìã –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –∑–∞–ø–∏—Å–∏');
  
  // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–µ–ª–µ–∫—Ç—ã —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
  const selects = document.querySelectorAll('[id^="opt-"]');
  
  selects.forEach(function(select) {
    // –ò–∑–≤–ª–µ–∫–∞–µ–º ID —É—Å–ª—É–≥–∏ –∏–∑ id —Å–µ–ª–µ–∫—Ç–∞ (opt-123 ‚Üí 123)
    const serviceId = select.id.replace('opt-', '');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
    updateBookingButton(serviceId);
  });
  
  console.log('‚úÖ –ö–Ω–æ–ø–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
});
</script>

{% endblock %}