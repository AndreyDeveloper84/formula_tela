{% extends "website/base.html" %}
{% load service_extras humanize %}
{% block title %}–£—Å–ª—É–≥–∏ ‚Äî {{ settings.salon_name }}{% endblock %}
{% block content %}
  <h1 class="text-3xl font-bold mb-6">–£—Å–ª—É–≥–∏</h1>

{% for cat in categories %}
  <h2 class="mb-4">{{ cat.name }}</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {% for s in cat.services.all %}
    {% if s.is_active %}
    <div class="p-5 rounded-2xl shadow bg-white">
      <h3 class="text-lg font-semibold mb-2">{{ s.name }}</h3>
      
      {% if s.options.all %}
        <div>
          <label class="block text-sm mb-1">–í–∞—Ä–∏–∞–Ω—Ç</label>
          <select name="service_option_id" id="opt-{{ s.id }}" class="w-full border rounded px-3 py-2 mb-3">
            {% for opt in s.options.all %}
              {% if opt.is_active %}
                <option
                  value="{{ opt.id }}"
                  data-duration="{{ opt.duration_min }}"
                  data-price="{{ opt.price }}"
                  data-yclients-id="{{ opt.yclients_service_id }}"
                >
                  {{ opt|option_label }}
                </option>
              {% endif %}
            {% endfor %}
          </select>

          {# –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–∏—Å–∏ - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç YClients –Ω–∞–ø—Ä—è–º—É—é #}
          <a class="btn" 
             href="#"
             onclick="openYClientsBooking(event, 'opt-{{ s.id }}'); return false;">
            –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
          </a>
        </div>
      {% else %}
        <p class="text-sm text-gray-500">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</p>
      {% endif %}
    </div>
    {% endif %}
  {% endfor %}
  </div>
{% endfor %}

<script>
function openYClientsBooking(event, selectId) {
  event.preventDefault();
  
  const select = document.getElementById(selectId);
  if (!select) {
    console.error("‚ùå –°–µ–ª–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:", selectId);
    return;
  }
  
  const selectedOption = select.options[select.selectedIndex];
  const yclientsId = selectedOption.getAttribute('data-yclients-id');
  
  console.log("üìã –û—Ç–∫—Ä—ã–≤–∞–µ–º –∑–∞–ø–∏—Å—å –Ω–∞ YClients");
  console.log("   Service ID:", yclientsId || "–Ω–µ —É–∫–∞–∑–∞–Ω");
  
  // –ë–∞–∑–æ–≤—ã–π URL –∫–æ–º–ø–∞–Ω–∏–∏
  let url = "https://n951024.yclients.com/company/{{ settings.yclients_company_id }}";
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å ID —É—Å–ª—É–≥–∏ - –¥–æ–±–∞–≤–ª—è–µ–º –≤ URL –¥–ª—è –ø—Ä–µ–¥–≤—ã–±–æ—Ä–∞
  if (yclientsId && yclientsId !== 'None' && yclientsId !== '') {
    url += `/select-service?o=&id=${yclientsId}`;
    console.log("   ‚úÖ –° –ø—Ä–µ–¥–≤—ã–±—Ä–∞–Ω–Ω–æ–π —É—Å–ª—É–≥–æ–π");
  } else {
    console.log("   ‚ÑπÔ∏è –û–±—â–∞—è —Ñ–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ (ID —É—Å–ª—É–≥–∏ –Ω–µ —É–∫–∞–∑–∞–Ω)");
  }
  
  console.log("   üîó URL:", url);
  
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
  const popup = window.open(
    url, 
    'yclients_booking', 
    'width=900,height=700,scrollbars=yes,resizable=yes'
  );
  
  if (!popup) {
    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –∑–∞–ø–∏—Å–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞.");
    console.error("‚ùå –ü–æ–ø–∞–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º");
  } else {
    console.log("‚úÖ –û–∫–Ω–æ –∑–∞–ø–∏—Å–∏ –æ—Ç–∫—Ä—ã—Ç–æ");
  }
}
</script>

{% endblock %}