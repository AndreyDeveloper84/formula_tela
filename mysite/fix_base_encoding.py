"""
Скрипт замены кракозябр в base.html на нормальную кириллицу.
Запускать из папки mysite/mysite/:
    python fix_base_encoding.py
"""

import re

filepath = "website/templates/website/base.html"

# Читаем файл
with open(filepath, "r", encoding="utf-8") as f:
    content = f.read()

# Словарь замен: кракозябра -> нормальный текст
replacements = [
    # Контакты, адрес, часы работы
    ("Р—Р°РїРёСЃР°С‚СЊСЃСЏ РЅР° РїСЂРѕС†РµРґСѓСЂС‹", "Записаться на процедуры"),
    ("РџРѕСЃС‚СЂРѕРёС‚СЊ РјР°СЂС€СЂСѓС‚", "Построить маршрут"),
    ("РђРґСЂРµСЃ: Рі. РџРµРЅР·Р°, СѓР». РџСѓС€РєРёРЅР°, 45", "Адрес: г. Пенза, ул. Пушкина, 45"),
    ("РђРґСЂРµСЃ:", "Адрес:"),
    ("Р•Р¶РµРґРЅРµРІРЅРѕ: СЃ 10:00-21:00", "Ежедневно: с 10:00-21:00"),
    ("РЎС‚СѓРґРёСЏ СЌСЃС‚РµС‚РёРєРё Р¤РѕСЂРјСѓР»Р° РўРµР»Р°", "Студия эстетики Формула Тела"),
    
    # Соцсети
    ("Р'РєРѕРЅС‚Р°РєС‚Рµ", "Вконтакте"),
    ("Р'РєРѕРЅС‚Р°РєС‚Рµ", "Вконтакте"),  # дубль на случай другой кодировки
    # Попробуем другие варианты кракозябр для "Вконтакте"
    ("Р\u0092РєРѕРЅС‚Р°РєС‚Рµ", "Вконтакте"),
    
    # Политика конфиденциальности
    ("РџРѕР»РёС‚РёРєР° РєРѕРЅС„РёРґРµРЅС†РёР°Р»СЊРЅРѕСЃС‚Рё", "Политика конфиденциальности"),
    
    # Дисклеймер
    ("Р¦РµРЅС‹, СѓРєР°Р·Р°РЅРЅС‹Рµ РЅР° СЃР°Р№С‚Рµ Рё РІ СЃРѕС†РёР°Р»СЊРЅС‹С… СЃРµС‚СЏС… РїСЂРёРІРµРґРµРЅС‹ РєР°Рє СЃРїСЂР°РІРѕС‡РЅР°СЏ РёРЅС„РѕСЂРјР°С†РёСЏ Рё РЅРµ СЏРІР»СЏСЋС‚СЃСЏ РїСѓР±Р»РёС‡РЅРѕР№ РѕС„РµСЂС‚РѕР№. РњРѕРіСѓС‚ Р±С‹С‚СЊ РёР·РјРµРЅРµРЅС‹ РІ Р»СЋР±РѕРµ РІСЂРµРјСЏ Р±РµР· РїСЂРµРґСѓРїСЂРµР¶РґРµРЅРёСЏ. Р"Р»СЏ РїРѕРґСЂРѕР±РЅРѕР№ РёРЅС„РѕСЂРјР°С†РёРё Рѕ СЃС‚РѕРёРјРѕСЃС‚Рё СѓСЃР»СѓРі РѕР±СЂР°С‰Р°Р№С‚РµСЃСЊ Рє Р°РґРјРёРЅРёСЃС‚СЂР°С‚РѕСЂР°Рј.",
     "Цены, указанные на сайте и в социальных сетях приведены как справочная информация и не являются публичной офертой. Могут быть изменены в любое время без предупреждения. Для подробной информации о стоимости услуг обращайтесь к администраторам."),

    # Copyright
    ("Р¤РћР РњРЈР›Рђ РўР•Р›Рђ 2025", "ФОРМУЛА ТЕЛА"),
    ("Р¤РћР\u0098РњРЈР›Рђ РўР•Р›Рђ", "ФОРМУЛА ТЕЛА"),
    
    # Модалка записи
    ("Р—Р°РїРёСЃСЊ РЅР° СЃРµР°РЅСЃ", "Запись на сеанс"),
    ("Р'С‹Р±РµСЂРёС‚Рµ СѓСЃР»СѓРіСѓ РґР»СЏ Р·Р°РїРёСЃРё", "Выберите услугу для записи"),
    ("РџРµСЂРµР№С‚Рё Рє СѓСЃР»СѓРіР°Рј", "Перейти к услугам"),
    ("Р—Р°РєСЂС‹С‚СЊ", "Закрыть"),
    
    # Header
    ("Р—Р°РїРёСЃР°С‚СЊСЃСЏ РѕРЅР»Р°Р№РЅ", "Записаться онлайн"),
    ("РЈСЃР»СѓРіРё", "Услуги"),
    ("РњР°СЃС‚РµСЂР°", "Мастера"),
    ("РђРєС†РёРё", "Акции"),
    ("РљРѕРјРїР»РµРєСЃС‹", "Комплексы"),
    ("РљРѕРЅС‚Р°РєС‚С‹", "Контакты"),
    ("Р"Р»Р°РІРЅР°СЏ", "Главная"),
    
    # Scroll top
    ("РќР°РІРµСЂС…", "Наверх"),
    
    # Прочее
    ("РёРЅРёС†РёР°Р»РёР·Р°С†РёСЏ", "инициализация"),
    ("СЌР»РµРјРµРЅС‚РѕРІ СЃ РєР»Р°СЃСЃРѕРј", "элементов с классом"),
]

count = 0
for old, new in replacements:
    if old in content:
        content = content.replace(old, new)
        count += 1
        print(f"  ✓ Заменено: {new}")

# Также заменим любые оставшиеся кракозябры через regex
# Ищем паттерны типа "Р" + латиница/спецсимволы (характерно для mojibake)
# Проверяем что не осталось

# Сохраняем
with open(filepath, "w", encoding="utf-8") as f:
    f.write(content)

print(f"\n{'='*50}")
print(f"Готово! Заменено {count} фрагментов.")
print(f"Файл сохранён: {filepath}")
print(f"\nЕсли остались кракозябры — найди их в PyCharm (Ctrl+F)")
print(f"и замени вручную на нормальный текст.")
